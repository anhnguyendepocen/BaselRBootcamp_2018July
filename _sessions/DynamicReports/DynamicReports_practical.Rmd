---
title: "Dynamic Reports"
subtitle: "With RMarkdown"
author: "BaselRBootcamp July 2018<br/><a href='https://therbootcamp.github.io'>www.therbootcamp.com</a><br/><a href='https://twitter.com/therbootcamp'>@therbootcamp</a>"
output:
  html_document:
    css: practical.css
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(comment = NA, 
                      fig.width = 6, 
                      fig.height = 6,
                      fig.align = 'center',
                      echo = FALSE, 
                      eval = FALSE, 
                      warning = FALSE)

options(digits = 3)

library(baselers)
library(tidyverse)
```


<figure>
<center>
  <img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2014/09/Caret-package-in-R.png" alt="Trulli" style="width:70%">
  <figcaption>www.rstudio.com</figcaption>
</figure>


## Overview

By the end of this practical you will know how to:

1. Create a new R Markdown file (`.Rmd`)
2. "Knit" an R Markdown file to an .html or .pdf report
3. Format text using formatting tags
4. Create code chunks
5. Include code output in sentences with inline chunks

## Packages

|Package| Installation|
|:------|:------|
|`tidyverse`|`install.packages("tidyverse")`|
|`knitr`|`install.packages("knitr")`|
|`DT`|`install.packages("DT")`|
|`broom`|`install.packages("broom")`|
|`rmdformats`|`install.packages("rmdformats")`|
|`xaringan`|`install.packages("xaringan")`|

### Cheatsheet

<a href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">
  <center><img src="http://westandproud.info/wp-content/uploads/2018/04/reproducible-and-interactive-research-with-regard-to-cheat-sheet-r-markdown.png" width="600px">
</a>

## Datasets

```{r, eval = TRUE, message = FALSE}
library(tidyverse)
mcdonalds <- read_csv("https://raw.githubusercontent.com/therbootcamp/BaselRBootcamp_2018July/master/_sessions/_data/complete/mcdonalds.csv")
```

|File  |Rows | Columns |
|:----|:-----|:------|
|[mcdonalds.csv](https://raw.githubusercontent.com/therbootcamp/BaselRBootcamp_2018July/master/_sessions/_data/complete/mcdonalds.csv)| 260 | 24 |

## Tasks

## A - Setup

1. Open your R project. It should already have the folders `0_Data` and `1_Code`. Make sure that the data files listed in the `Datasets` section above are in your `1_Data` folder

```{r}
# Done!
```

2. Because R Markdown looks quite a bit different from standard R code, the best way to look at examples is to see a new R Markdown document in action. In RStudio, click File -- New File -- R Markdown

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "60%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/rmarkdown_ss_A.png")
```

3.  Give the document a title and an author. For the output format, select HTML (the default). Click Ok!

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "60%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/rmarkdown_ss_B.png")
```

4. A new file that looks like this should open up. This is your first R Markdown document!

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "60%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/rmarkdown_ss_C.png")
```

5. Save your markdown file *in your main project directory* (not in the `4_Markdown` folder! -- you'll put it there later!) under the name `mcdonalds.Rmd`

6. Now *knit* your document to an HTML file. To do this, click the *knit* button (or use the Command + Shift + K shortcut)

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "60%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/rmarkdown_ss_D.png")
```

7. Now you should see your final, HTML document! Scroll up and down the document and see how she looks!

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "60%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/rmarkdown_ss_E.png")
```

## B - Load packages, data and set default chunk options

1. You should always start your markdown file by loading packages and data in a code chunk. We'll do this inside of the first chunk with the `setup` label. Inside of this chunk, write the comment `# Load Packages -------------`. Then, using the `library()` function, load the packages listed in the `Packages` section above. 

```{r, echo = FALSE, fig.align = 'center', eval = TRUE, out.width = "50%"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/setup_chunk.jpg")
```

2. Knit your document! Make sure you don't get any errors!

3. Now it's time to load your datafiles. In the *same* `setup` chunk, load each of the data files listed in the `Datasets` section. 

```{r, eval = FALSE, echo = TRUE}
# --- Load packages
library(XX)
library(XX)

# --- Load data
XXX <- read_csv()
XXX <- read_csv()
```

4. Knit your document! Make sure you don't get any errors!

5. Now it's time to change some of the default chunk options. In your *setup* chunk, change the existing values of `knitr::opts_chunk$set` to the following:

```{r, echo = TRUE, eval = FALSE}
# INCLUDE ALL OF THIS CODE IN YOUR FIRST CHUNK!

knitr::opts_chunk$set(fig.width = 6,        # Figure width (in)
                      fig.height = 4,       # Figure height (in)
                      echo = FALSE,          # Repeat code
                      eval = TRUE,          # Evaluate chunks
                      message = FALSE,      # Don't print messages
                      warning = FALSE,      # Don't print warnings
                      fig.align = 'center') # Center figures

options(digits = 2)  # Round all output to 2 digits


```

6. Knit your document! Make sure you see an output!

## C - Add formatted text

1. Below your last markdown chunk, write the necessary text and Markdown tags to create the following sentence. Be sure to create italic and bold text using the proper formatting tags!

- In this practical, I will analyse two datasets and show reproducible results in a dynamic document created in R Markdown. R Markdown is great because I can integrate R code directly into my document, and easily use *italics* and **bold** using formatting tags.

2. Create a new first level header with the text "McDonalds" using a single hashtag

3. Knit the document!

4. You can find the McDonalds logo on wikipedia at the following link: [https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/McDonald%27s_Golden_Arches.svg/2000px-McDonald%27s_Golden_Arches.svg.png](https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/McDonald%27s_Golden_Arches.svg/2000px-McDonald%27s_Golden_Arches.svg.png). Using the `include_graphics()` function, include this image in your document (To make the image a bit smaller, include the chunk argument `out.width = "30%"`)

```{r, out.width = "30%", fig.cap="Source: Wikipedia", echo = TRUE, eval = FALSE}
include_graphics("https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/McDonald%27s_Golden_Arches.svg/2000px-McDonald%27s_Golden_Arches.svg.png")
```

5. Include the appropriate text and formatting to write the following sentence. When writing the number of columns and rows, use in-line chunks to get the data directly from the `mcdonalds` object! You can get the number of columns with `ncol(mcdonalds)` and the number of rows with `nrow(mcdonalds)`

- The `mcdonalds` data has `r ncol(mcdonalds)` columns and `r nrow(mcdonalds)` rows. Each row corresponds to a different menu item. The data originally come from [Kaggle](https://www.kaggle.com/mcdonalds/nutrition-facts).

## D - Add a formatted table with `datatable()`

1. Create a new code chunk by either clicking the "Insert - R" button, or by using the "Command + Option + I"" shortcut on Mac

2. Inside the chunk, include the following code which uses the `datatable` function to render a dataframe as a nicely formatted HTML table.

```{r, eval = FALSE, echo = TRUE}
datatable(mcdonalds %>% select(1:6))
```

3. Knit the document! Do you see your nicely formatted table?

## E - Add plots

1. Write the appropriate combination of markdown, text, and code to create the following output (Here's some `ggplot2` code that might help!)

```{r, eval = TRUE, echo = FALSE, out.width="75%"}
knitr::include_graphics("https://github.com/therbootcamp/therbootcamp.github.io/blob/master/_sessions/_image/calories_histogram.jpg?raw=true")
```

```{r, eval = FALSE, echo = TRUE}
ggplot(data = mcdonalds,
       aes(x = XX)) +
  geom_histogram(col = "white") +
  labs(title = "XX",
       subtitle = "XX",
       caption = "XX") +
  theme_bw()
```


2. Knit the document! Diagnose and correct any errors!

3. Write the appropriate combination of markdown, text, and code to create the following output (Here's some `ggplot2` code that might help!):

```{r, eval = TRUE, echo = FALSE, out.width="75%"}
knitr::include_graphics("https://github.com/therbootcamp/therbootcamp.github.io/blob/master/_sessions/_image/calories_sodium_ss.jpg?raw=true")
```

```{r, eval = FALSE, echo = TRUE}
ggplot(data = XX,
       aes(x = XX, y = XX)) +
  geom_point() +
  labs(title = "XX",
       subtitle = "XX",
       caption = "XX") +
  theme_bw()
```

4. Knit the document! Diagnose and correct any errors!

## F - Add a table of statistical test results

Now let's show the results of a regression analysis predicting the sodium content of an item as a function of its calories.

1. Create a new code chunk. Inside of the chunk, create an object called `cal_sod_lm`  that is the result of a regression analysis predicting `Sodium` as a function of `Calories`. Use the following template

```{r, eval = FALSE, echo = TRUE}
# Create regression model predicting Sodium from Calories

cal_sod_lm <- lm(formula = XX ~ XX,
                 data = mcdonalds)
```

2. Now, using the following template for help, write the appropirate text / code to create the following output.

```{r, echo = TRUE, eval = FALSE}
# Export cal_sod_lm to a nicely formatted table

kable(x = tidy(cal_sod_lm), 
      digits = 3, 
      caption = "Regression analysis predicting Sodium from Calories")
```

```{r, eval = TRUE, echo = FALSE, out.width="75%"}
knitr::include_graphics("https://github.com/therbootcamp/therbootcamp.github.io/blob/master/_sessions/_image/regression_output.jpg?raw=true")
```

3. Knit the document! Diagnose and correct any errors!


## G - Keep going!

1. Add the appropriate code to add the following output. 

```{r, eval = TRUE, echo = FALSE, out.width="75%"}
knitr::include_graphics("https://github.com/therbootcamp/therbootcamp.github.io/blob/master/_sessions/_image/calories_category_ss.jpg?raw=true")
```

```{r, echo = TRUE, eval = FALSE}
ggplot(data = mcdonalds,
       aes(x = XX, y = XX, fill = XX)) +
  stat_summary(geom = "bar", fun.y = "mean") +
  guides(fill = FALSE) +
  labs(title = "McDonalds Menu Items",
       subtitle = "Created with ggplot2",
       caption = "Source: Kaggle.com") +
  theme_bw()
```

2. Knit the document! Diagnose and correct any errors!

3. Add the appropriate code to add the following output. 

```{r, eval = TRUE, echo = FALSE, out.width="75%"}
knitr::include_graphics("https://github.com/therbootcamp/therbootcamp.github.io/blob/master/_sessions/_image/calories_category_summary_ss.jpg?raw=true")
```

```{r, echo = TRUE, eval = FALSE}
Calories_agg <- XX %>%
  group_by(XX) %>%
  summarise(
    Min = min(Calories),
    Mean = mean(Calories),
    Median = median(Calories),
    Max = max(Calories)
  )

kable(x = XX, 
      caption = "XX")
```

4. Knit the document! Diagnose and correct any errors!


## G - Managing working directories with Markdown

1. Now it's time to move your Markdown file to your `4_Markdown` folder. Move your `speffanalysis.Rmd` file to your `4_Markdown` folder using your computer file browser (Finder on Mac, Windows explorer on PC). Now, try knitting your document. You should get an error! What happened?!

2. The problem is that when you knit your Markdown file, R changes your working directory to the folder where your markdown file is located. However, now that you moved your file to your `4_Markdown` folder, this isn't true anymore. You need to tell Markdown that the root directory of your project is one directory up! Thankfully this is easy to do. Just add the following code to your initial `setup` R chunk:

```{r, echo = TRUE}
# Tell R Markdown that the root directory is now one folder
#   up from the folder the markdown file is in

knitr::opts_knit$set(root.dir = "../")
```

3. Knit your document! Did everything work? If not, try to correct the working directory issues. Don't be afraid to ask for help!

## X - Add results from the happiness survey

1. If you've gotten this far, then you've really gotten the hang of R Markdown! Try adding the correct combination of text, tags, and code to add all of the results from the `happiness` data contained here:




### References and Links

- Want to see the .Rmd file that created this practical? You can find it [here](https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/D4S2_DynamicReports/DynamicReports_practical.Rmd).

- The `rmdformats` package has many nice templates for .Rmd files. Look at their GitHub page at [https://github.com/juba/rmdformats](https://github.com/juba/rmdformats) for examples. If you install the package from CRAN with `install.packages('rmdformats')`, you'll get lots of new templates when you open a new Markdown file in RStudio. 

- If you want to use custom .css files, check out the the [R Studio HTML document guide](http://rmarkdown.rstudio.com/html_document_format.html#custom_css). You can also look at the .css files underlying the `rmdformats` package on their GitHub page here [https://github.com/juba/rmdformats](https://github.com/juba/rmdformats). For example, here is their .css file for the "html docco" template [https://raw.githubusercontent.com/juba/rmdformats/master/inst/templates/html_docco/docco.css](https://raw.githubusercontent.com/juba/rmdformats/master/inst/templates/html_docco/docco.css)
