---
title: "Statistics"
subtitle: ""
author: "Basel R Bootcamp<br/><a href='https://therbootcamp.github.io'>www.therbootcamp.com</a><br/><a href='https://twitter.com/therbootcamp'>@therbootcamp</a>"
date: "July 2018"
output:
  xaringan::moon_reader:
    css: ["default", "baselrbootcamp.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

layout: true

<div class="my-footer"><span>
<a href="https://therbootcamp.github.io/"><font color="#7E7E7E">BaselRBootcamp, July 2018</font></a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="https://therbootcamp.github.io/"><font color="#7E7E7E">www.therbootcamp.com</font></a>
</span></div> 

---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
# see: https://github.com/yihui/xaringan
# install.packages("xaringan")
# see: 
# https://github.com/yihui/xaringan/wiki
# https://github.com/gnab/remark/wiki/Markdown

  
options(max.print = 20)
options(width=110)
options(digits = 4)
library(tidyverse)
ChickWeight <- as.data.frame(ChickWeight)
baselers <- read_csv("https://raw.githubusercontent.com/therbootcamp/baselers/master/inst/extdata/baselers.txt")

trial_X <- data.frame(id = 1:5,
           sex = c("m", "f", "f", "m", "f"),
           age = c(35, 42, 24, 56, 49),
           arm = c(1, 2, 1, 2, 1),
           y_primary = c(50, 78, 46, 97, 74),
           y_secondary = c(1, 1, 0, 1, 1)
           )

knitr::opts_chunk$set(warning = FALSE)

```

# There is always a package for that!

.pull-left45[

<br2>

| Package| Models|
|------:|:----|
| `stats`|Generalized linear model|
|     `afex`|   Anovas|
|     `lme4`|   Mixed effects regression|
|     `rpart`|    Decision Trees|
|     `BayesFactor`| Bayesian statistics|
|     `igraph`| Network analysis|
|     `neuralnet`| Neural networks|
|     `MatchIt`| Matching and causal inference|
|     `survival`| Longitudinal survival analysis|
|     ...| Anything you can ever want!|



]

.pull-right5[

```{r, echo = FALSE, out.width = "100%", fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/statistical_procedures.png")
```

]


---

.pull-left45[



1 - Basic structure and arguments of most statistical functions

- `formula`: Specify your <high>variables</high>
- `data`: A <high>data frame</high> containing variables.
    
2 - Simple `htest` objects

- t.test, correlation

3 - (Generalized) linear model 
- `lm()`, `glm()`, `aov()`

4 - Common methods to explore statistical objects
- `print()`, `summary()`, `names()`, `predict()`, `plot()`

5 - Dissect statistical objects with `$`

Work with R's library of statistical distributions
- `rnorm()`, `runif()`

]

.pull-right5[

```{r, eval = FALSE}
# T-test comparing height based on gender
t.test(formula = height ~ sex,
         data = baselers)

# Regression model
inc_glm <- glm(formula = income ~ .,
               data = baselers %>% select(-id))

# Summary information
summary(inc_glm)  

# Dissect
inc_glm$coefficients # Acess coefficients
inc_glm$residuals # Access residuals

### Generate random data
x1 <- rnorm(n = 100, mean = 10, sd = 5)
x2 <- rnorm(n = 100, mean = 5, sd = 1)
noise <- rnorm(n= 100, mean = 0, sd = 10)

# Create y as a function of x1, x2, and noise
y <- x1 + x2 + noise

df <- data.frame(x1, x2, y)

# Regress y on x1 and x2
lm(formula = y ~ ., 
   data = df)
```

]

---

# Basic structure of statistical functions

.pull-left4[

Statistical functions always require a <high>data frame</high> called `data`

```{r, echo = FALSE}
baselers %>%
  slice(1:3) %>% select(2:6) %>% knitr::kable(format = 'markdown')
```

They also require a <high>formula</high> that specifies a <high>dependent</high> variable (y) as a function of one or more <high>independent</high> variables (x1, x2, ...) in the form:

<p align='center'><font size = 6>formula = y ~ x1 + x2 +...</font></p>

The short hand `formula = y ~ .` means include all variables

]

.pull-right55[

To create a statistical object, apply the statistical function `STAT_FUN` with the `formula` and `data` arguments:

```{r, echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/formula_description.png")
```


```{r}
# Create regression object (my_glm)
my_glm <- glm(formula = income ~ age + height,
              data = baselers)
```

]

---
 
.pull-left4[

## Look for optional arguments

Statistical functions may have many optional arguments (look at help menus!)

Each of these have <high>default</high> values. If you don't specify them, the function will use the default.

To customise a test, look at the help menu and specify arguments explicitly.

### ?glm()

```{r, echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/glm_help.jpg")
```

]


.pull-right55[

Default vs. Customised Generalized linear model (GLM)

```{r, eval = FALSE}
# GLM

# Default
glm(formula = income ~ age + education,
    data = baselers)

# Customised
glm(formula = eyecor ~ age + education,
    data = baselers,
    family = "binomial")  # Logistic regression
```

Default vs. Customised t-test

```{r, eval = FALSE}
# T-test

# Default
t.test(formula = age ~ sex,
       data = baselers)

# Customised
t.test(formula = age ~ sex,
       data = baselers,
       alternative = "less", # One sided test
       var.equal = TRUE)     # Assume equal variance
```

]



---

.pull-left45[

## Simple hypothesis tests

All of the basic one and two sample hypothesis tests are included in the stats package

| Hypothesis Test| R Function|
|------:|----:|
|     T-test|    `t.test()`|
|     Correlation Test|    `cor.test()`|
|     Chi-Square Test|   `chisq.test()`|

These tests are unique because they can take either formula arguments, or individual vector arguments `x`, and `y`

]


.pull-right5[

### T-Test with t.test()

```{r}
# 1-sample t-test
t.test(x = baselers$age, 
       mu = 40)  # Mean under H0

```

```{r, eval = FALSE}
# 2-sample t-test
t.test(formula = income ~ sex,
       data = baselers)

# Note: Output hidden
```


]



---

.pull-left45[

## Simple hypothesis tests

All of the basic one and two sample hypothesis tests are included in the stats package

| Hypothesis Test| R Function|
|------:|----:|
|     T-test|    `t.test()`|
|     Correlation Test|    `cor.test()`|
|     Chi-Square Test|   `chisq.test()`|

These tests are unique because they can take either formula arguments, or individual vector arguments `x`, and `y`

]


.pull-right5[

### Correlation test with cor.test()

```{r}
# Correlation test
cor.test(x = baselers$age,
         y = baselers$income)
```


```{r, eval = FALSE}
# Version using formula (same result as above)
cor.test(formula = ~ age + income,
         data = baselers)
```


]

---


.pull-left35[

## Regression with glm(), lm()


Part of the `baselers` dataframe:

```{r, echo = FALSE}
baselers %>% 
  select(food, income, happiness) %>%
  slice(1:5) %>% 
  knitr::kable(format = "markdown")
```

**Goal**: Create a regression model predicting how much money people spend on `food` as a function of `income`

<br>
<!-- $$\Large food = \beta_{0} + \beta_{1} \times Inc + \beta_{1} \times Hap+ \epsilon$$ -->

]

.pull-right6[

`lm()` is for simple linear regression, while `glm()` is <high>generalized</high>.

```{r}
# Create a glm object called food_glm

# food (y) on income (x1) and happiness (x2)
food_glm <- glm(formula = food ~ income + happiness,
              data = baselers)

# Print food_glm
food_glm
```

]


---

## Customising formulas

Include additional independent variables to formulas by "adding" them with <high>`+`</high> 

```{r}
# Include multiple terms with +
my_glm <- glm(formula = income ~ food + alcohol + happiness + hiking,
              data = baselers)
```

To <high>include all variables</high> in a dataframe, use the catch-all notation <high>`formula = y ~ .`</high>

```{r}
# Use  y ~ . to include ALL variables
my_glm <- glm(formula = income ~ .,
              data = baselers)
```

To include <high>interaction terms</high> use `x1 * x2` instead of `x1 + x2`

```{r}
# Include an interaction term between food and alcohol
my_glm <- glm(formula = income ~ food * alcohol,
              data = baselers)
```

---

.pull-left35[
## Exploring statistical objects

Explore statistical objects using <high>generic</high> functions such as `print()`, `summary()`, `predict()` and `plot()`.

```{r, eval = FALSE}
# Create statistical object
obj <- STAT_FUN(formula = ...,
                data = ...)

names(obj)       # Elements
print(obj)       # Print
summary(obj)     # Summary
plot(obj)        # Plotting
predict(obj, ..) # Predict
```

Generic functions won't work for all statistical objects, but it is a great idea to try each of them!

]

.pull-right6[
<br>

```{r, eval = TRUE}
# Create a glm object
my_glm <- glm(formula = income ~ happiness + age,
              data = baselers)
```

Apply the `print()` function to a statistical object

```{r, eval = TRUE}
# Print the object
print(my_glm)
```

]



---

.pull-left35[
## Exploring statistical objects

Explore statistical objects using <high>generic</high> functions such as `print()`, `summary()`, `predict()` and `plot()`.

```{r, eval = FALSE}
# Create statistical object
obj <- STAT_FUN(formula = ...,
                data = ...)

names(obj)       # Elements
print(obj)       # Print
summary(obj)     # Summary
plot(obj)        # Plotting
predict(obj, ..) # Predict
```

Generic functions won't work for all statistical objects, but it is a great idea to try each of them!
]

.pull-right6[
<br>

```{r, eval = TRUE}
# Create a glm object
my_glm <- glm(formula = income ~ happiness + age,
              data = baselers)
```

Apply the `summary()` function to a statistical object

```{r, eval = TRUE}
# Print the object
summary(my_glm)
```

]


---

.pull-left35[
## Exploring statistical objects

Explore statistical objects using <high>generic</high> functions such as `print()`, `summary()`, `predict()` and `plot()`.

```{r, eval = FALSE}
# Create statistical object
obj <- STAT_FUN(formula = ...,
                data = ...)

names(obj)       # Elements
print(obj)       # Print
summary(obj)     # Summary
plot(obj)        # Plotting
predict(obj, ..) # Predict
```

Generic functions won't work for all statistical objects, but it is a great idea to try each of them!
]

.pull-right6[

### Statistical objects are lists! Explore them!

Almost <high>all statistical objects are lists</high>. They all have named elements you can access with <high>`$`</high>. To see all of the named elements, use `names()`

```{r, eval = TRUE}
# What are the named elements
names(my_glm)
```
 
 
```{r, echo = FALSE, out.width = "70%", fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/list_tab.png")
```


]


---

.pull-left35[
## Exploring statistical objects

Explore statistical objects using <high>generic</high> functions such as `print()`, `summary()`, `predict()` and `plot()`.

```{r, eval = FALSE}
# Create statistical object
obj <- STAT_FUN(formula = ...,
                data = ...)

names(obj)       # Elements
print(obj)       # Print
summary(obj)     # Summary
plot(obj)        # Plotting
predict(obj, ..) # Predict
```

Generic functions won't work for all statistical objects, but it is a great idea to try each of them!

]

.pull-right6[

### Statistical objects are lists! Explore them!

Explore statistical objects using many <high>generic</high> functions such as `print()`, `summary()`, `predict()` and `plot()`.

```{r}
# Look at coefficients
my_glm$coefficients

# First 5 fitted values
my_glm$fitted.values[1:5]

# First 5 residuals
my_glm$residuals[1:5]
```


]


---

.pull-left35[
## predict()

`predict(object, newdata)` allows you to use your statistical `object` to <high>predict outcomes</high> from a new data frame called `newdata`.

```{r, echo = FALSE}
lastyear <- baselers %>% slice(1:100)
thisyear <- baselers %>% slice(101:200)
```

```{r, eval = FALSE}
lastyear
```

```{r, echo = FALSE}
lastyear  %>% select(id, age, fitness, tattoos, income) %>% 
  slice(1:3) %>% knitr::kable(format = "markdown")
```

```{r, echo = TRUE, eval = FALSE}
thisyear
```


```{r, echo = FALSE}
thisyear  %>% select(id, age, fitness, tattoos) %>% slice(1:3) %>% mutate(income = NA) %>% knitr::kable(format = "markdown")
```


]


.pull-right6[

<br><br>

Create <high>`model`</high> based on `leastyear`

```{r}
# Create regression model predicting income
model <- lm(formula = income ~ age + fitness + tattoos,
            data = lastyear)

model$coefficients
```

Now use `model` to <high>`predict`</high> values for `thisyear`

```{r, eval = FALSE, echo = TRUE}
# Predict the income of people in thisyear
predict(object = model, 
        newdata = thisyear)
```

```{r, eval = TRUE, echo = FALSE}
# Predict the income of people in thisyear
predict(object = model, 
        newdata = thisyear)[1:3]
```

]

---

.pull-left4[

## tidy()

The `tidy()` function from the `broom` package converts the most important results of many statistical object like "glm" to a data frame

```{r, echo = FALSE, out.width = "70%", fig.align="center"}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/broom_hex.png")
```

```{r, eval = FALSE}
# Install the broom package
install.packages("broom")
```


]

.pull-right55[

```{r}
# Load boom package
library(broom)

# Original printout
my_glm
```


```{r}
# Tidy printout
tidy(my_glm)
```

Try it on your favorite models and see the magic!

]



---

.pull-left45[

## Sampling Functions

R gives you a host of functions for sampling data from common <high>statistical distributions</high>

| Distribution| R Function|
|------:|----:|
|    Normal| `rnorm()`|    
|      Uniform|`runif()`|
|      Beta|`rbeta()`|  
|      Binomial|`rbinom()`|  

Use these to easily <high>simulate data</high>

]

.pull-right5[

<font size = 5>?distributions</font>

```{r, echo = FALSE, out.width = "90%", fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/distributions_help.png")
```

]

---

.pull-left45[

## sample()

Use `sample()` to draw a random sample from a vector

```{r}
# Simulate 10 flips of a fair coin
coin_flips <- sample(x = c("H", "T"), 
                     size = 10, 
                     prob = c(.5, .5),
                     replace = TRUE)

coin_flips

# Table of counts
table(coin_flips) 
```

]


.pull-right5[

### Simulate the birthday problem

```{r, out.width = "20%", echo = FALSE, fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/balloons.png")
```

```{r}
# Create an empty room
birthdays <- c()

# While none of the birthdays are the same,
#  keep adding new ones
while(all(!duplicated(birthdays))) {
  
  # Get new birthday
  new_day <- sample(x = 1:365, size = 1)
  
  # Add new_day to birthdays
  birthdays <- c(birthdays, new_day)
  
}

# Done! How many are in the room??
length(birthdays)
```

]

---

.pull-left5[

## rnorm(), runif()...

Use the `rnorm()`, `runif()`... functions to draw random samples from probability distributions


```{r, fig.width = 5, fig.height = 5, message = FALSE, warning = FALSE, out.width = "90%"}
# Random sample from Normal distribution

mysamp <- rnorm(n = 100,   # Number of samples
                mean = 10, # Mean of pop
                sd = 5)    # SD of pop ...

mysamp[1:5]  # First 5 values
mean(mysamp) # Mean
sd(mysamp)   # Standard deviation
```


]

.pull-right45[

```{r, fig.width = 3, fig.height = 3, message = FALSE, warning = FALSE, out.width = "100%",dpi=300}
ggplot(data = tibble(x = mysamp),
       aes(x = x, y = ..density..)) +
  geom_histogram(col = "white", 
                 bins = 10) + 
  geom_density(col = "red", size = 1.5) + 
  theme_minimal()
```

]

---

.pull-left45[
<br><br>
## Other great statistics packages
<br>

|package|Description|
|:----|:-----|
|`afex`|Factorial experiments|
|`lme4`|Mixed effects models|
|`rstanarm`|Bayesian mixed effects models|
|`BayesFactor`|Bayesian Models|
|`forecast`|Time series| 
|`lavaan`|Latent variable and structural equation modelling| 


]


.pull-right5[

```{r, echo = FALSE, fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/lavaan_ss.jpg")
```


```{r, echo = FALSE, fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/Erfurt_2018June/master/_sessions/_image/BayesFactor_ss.png")
```


]

---

.pull-left45[
<br><br>
## Summary

R has a package for every statistical procedure you can imagine.

Most have <high>formula</high> and <high>data</high> arguments (among many others).

Use help menus to understand arguments!

Once you've created a statistical object, use generic functions (`print()`, `names()`, `summary()`), to explore it.

Use random sampling functions to run simulations.

]

.pull-right5[

`?t.test`

```{r, echo = FALSE, out.width = "100%", fig.align = 'center'}
knitr::include_graphics("https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/ttesthelp_ss.png")
```

]


---

<br>

## Questions?

## [Demo and Practical](https://therbootcamp.github.io/BaselRBootcamp_2018July/_sessions/Statistics/Statistics_practical.html)

<br>

```{r, echo = FALSE, out.width = "55%", fig.align = 'center', fig.cap="Source: Lynda.com"}
knitr::include_graphics("https://cdn.lynda.com/course/495322/495322-636154038826424503-16x9.jpg")
```
